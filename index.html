<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel com Firebase Modular</title>
  <style>
    /* Coloque aqui o CSS do painel que você já tem */
  </style>
</head>
<body>

<div id="botaoPainel">🛠️</div>

<div id="painel">
  <div id="cabecalhoPainel">Painel</div>

  <button onclick="alternarSecao('blocoNotas')">📘 Notas</button>
  <div id="blocoNotas" class="secaoPainel">
    <textarea id="textareaNotas" placeholder="Digite suas anotações..."></textarea>
  </div>

  <button onclick="alternarSecao('containerCronometro')">⏱️ Cronômetro</button>
  <div id="containerCronometro" class="secaoPainel">
    <div id="cronometro">00:00:00</div>
    <button onclick="iniciarCronometro()">Iniciar</button>
    <button onclick="pararCronometro()">Parar</button>
    <button onclick="resetarCronometro()">Resetar</button>
  </div>
</div>

<!-- Firebase Modular SDK -->
<script type="module">
  // Importando módulos necessários
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyATG5P2NvdecjCPO7gzFNGs6l7plDrxY04",
    authDomain: "sdel-16c6a.firebaseapp.com",
    projectId: "sdel-16c6a",
    storageBucket: "sdel-16c6a.appspot.com",
    messagingSenderId: "676676370586",
    appId: "1:676676370586:web:444947d3dda78a80d9df23",
    measurementId: "G-FZWQ9FYZG5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const userId = "usuario_demo"; // Substituir por UID real se tiver login

  // === BLOCO DE NOTAS ===
  const textareaNotas = document.getElementById('textareaNotas');

  // Carregar do Firebase
  get(child(ref(db), `usuarios/${userId}/anotacoes`)).then(snapshot => {
    if (snapshot.exists()) {
      textareaNotas.value = snapshot.val();
    }
  });

  // Salvar automaticamente ao digitar
  textareaNotas.addEventListener('input', () => {
    set(ref(db, `usuarios/${userId}/anotacoes`), textareaNotas.value);
  });

  // === CRONÔMETRO ===
  let segundos = 0, minutos = 0, horas = 0;
  let intervalo = null;

  const cronometro = document.getElementById('cronometro');

  const formatar = (n) => n.toString().padStart(2, '0');

  function atualizarCronometro() {
    segundos++;
    if (segundos === 60) { segundos = 0; minutos++; }
    if (minutos === 60) { minutos = 0; horas++; }

    cronometro.textContent = `${formatar(horas)}:${formatar(minutos)}:${formatar(segundos)}`;

    // Salvar tempo
    set(ref(db, `usuarios/${userId}/cronometro`), { horas, minutos, segundos });
  }

  function iniciarCronometro() {
    if (!intervalo) intervalo = setInterval(atualizarCronometro, 1000);
  }

  function pararCronometro() {
    clearInterval(intervalo);
    intervalo = null;
  }

  function resetarCronometro() {
    pararCronometro();
    horas = minutos = segundos = 0;
    cronometro.textContent = "00:00:00";
    set(ref(db, `usuarios/${userId}/cronometro`), { horas: 0, minutos: 0, segundos: 0 });
  }

  // Carregar tempo salvo
  get(child(ref(db), `usuarios/${userId}/cronometro`)).then(snapshot => {
    if (snapshot.exists()) {
      const tempo = snapshot.val();
      horas = tempo.horas || 0;
      minutos = tempo.minutos || 0;
      segundos = tempo.segundos || 0;
      cronometro.textContent = `${formatar(horas)}:${formatar(minutos)}:${formatar(segundos)}`;
    }
  });

  // === Alternar seções ===
  window.alternarSecao = (id) => {
    const secao = document.getElementById(id);
    secao.style.display = secao.style.display === 'block' ? 'none' : 'block';
  };

  // === Mostrar/esconder painel ===
  document.getElementById('botaoPainel').onclick = () => {
    const painel = document.getElementById('painel');
    painel.style.display = painel.style.display === 'block' ? 'none' : 'block';
  };

</script>
</body>
</html>
