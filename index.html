<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel com Login Google</title>
  <style>
    #painel, .secaoPainel { display: none; }
    #botaoPainel { cursor: pointer; padding: 8px; background: #007BFF; color: white; border-radius: 8px; width: fit-content; margin: 10px; }
    #painel { padding: 10px; border: 1px solid #ccc; margin: 10px; background: #f9f9f9; }
    #cabecalhoPainel { font-weight: bold; margin-bottom: 10px; }
  </style>
</head>
<body>

<!-- Botão login -->
<div id="loginContainer">
  <button id="btnLogin">🔐 Entrar com Google</button>
  <span id="userName"></span>
</div>

<!-- Painel -->
<div id="botaoPainel">🛠️ Abrir Painel</div>

<div id="painel">
  <div id="cabecalhoPainel">Painel</div>

  <button onclick="alternarSecao('blocoNotas')">📘 Notas</button>
  <div id="blocoNotas" class="secaoPainel">
    <textarea id="textareaNotas" placeholder="Digite suas anotações..."></textarea>
  </div>

  <button onclick="alternarSecao('containerCronometro')">⏱️ Cronômetro</button>
  <div id="containerCronometro" class="secaoPainel">
    <div id="cronometro">00:00:00</div>
    <button onclick="iniciarCronometro()">Iniciar</button>
    <button onclick="pararCronometro()">Parar</button>
    <button onclick="resetarCronometro()">Resetar</button>
  </div>
</div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyATG5P2NvdecjCPO7gzFNGs6l7plDrxY04",
    authDomain: "sdel-16c6a.firebaseapp.com",
    projectId: "sdel-16c6a",
    storageBucket: "sdel-16c6a.appspot.com",
    messagingSenderId: "676676370586",
    appId: "1:676676370586:web:444947d3dda78a80d9df23",
    measurementId: "G-FZWQ9FYZG5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  let uid = null;

  // === Login Google ===
  document.getElementById('btnLogin').onclick = () => {
    signInWithPopup(auth, provider).then(result => {
      const user = result.user;
      document.getElementById('userName').textContent = `👤 ${user.displayName}`;
    }).catch(error => {
      alert("Erro no login: " + error.message);
    });
  };

  // === Após login ===
  onAuthStateChanged(auth, user => {
    if (user) {
      uid = user.uid;
      document.getElementById('userName').textContent = `👤 ${user.displayName}`;
      carregarNotas(uid);
      carregarCronometro(uid);
    }
  });

  // === BLOCO DE NOTAS ===
  const textareaNotas = document.getElementById('textareaNotas');

  function carregarNotas(uid) {
    get(child(ref(db), `usuarios/${uid}/anotacoes`)).then(snapshot => {
      if (snapshot.exists()) textareaNotas.value = snapshot.val();
    });
  }

  textareaNotas.addEventListener('input', () => {
    if (uid) set(ref(db, `usuarios/${uid}/anotacoes`), textareaNotas.value);
  });

  // === CRONÔMETRO ===
  let segundos = 0, minutos = 0, horas = 0;
  let intervalo = null;
  const cronometro = document.getElementById('cronometro');
  const formatar = (n) => n.toString().padStart(2, '0');

  function atualizarCronometro() {
    segundos++;
    if (segundos === 60) { segundos = 0; minutos++; }
    if (minutos === 60) { minutos = 0; horas++; }
    cronometro.textContent = `${formatar(horas)}:${formatar(minutos)}:${formatar(segundos)}`;
    if (uid) set(ref(db, `usuarios/${uid}/cronometro`), { horas, minutos, segundos });
  }

  function iniciarCronometro() {
    if (!intervalo) intervalo = setInterval(atualizarCronometro, 1000);
  }

  function pararCronometro() {
    clearInterval(intervalo);
    intervalo = null;
  }

  function resetarCronometro() {
    pararCronometro();
    horas = minutos = segundos = 0;
    cronometro.textContent = "00:00:00";
    if (uid) set(ref(db, `usuarios/${uid}/cronometro`), { horas: 0, minutos: 0, segundos: 0 });
  }

  function carregarCronometro(uid) {
    get(child(ref(db), `usuarios/${uid}/cronometro`)).then(snapshot => {
      if (snapshot.exists()) {
        const tempo = snapshot.val();
        horas = tempo.horas || 0;
        minutos = tempo.minutos || 0;
        segundos = tempo.segundos || 0;
        cronometro.textContent = `${formatar(horas)}:${formatar(minutos)}:${formatar(segundos)}`;
      }
    });
  }

  // === Alternar seções ===
  window.alternarSecao = (id) => {
    const secao = document.getElementById(id);
    secao.style.display = secao.style.display === 'block' ? 'none' : 'block';
  };

  // === Mostrar painel ===
  document.getElementById('botaoPainel').onclick = () => {
    const painel = document.getElementById('painel');
    painel.style.display = painel.style.display === 'block' ? 'none' : 'block';
  };
</script>

</body>
</html>
